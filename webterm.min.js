class WebTerm{constructor(e){this.foregroundColors={30:"#2e3436",31:"#cc0000",32:"#4e9a06",33:"#c4a000",34:"#3465a4",35:"#75507b",36:"#06989a",37:"#d3d7cf",90:"#555753",91:"#ef2929",92:"#8ae234",93:"#fce94f",94:"#729fcf",95:"#ad7fa8",96:"#34e2e2",97:"#eeeeee"},this.backgroundColors={40:"#2e3436",41:"#cc0000",42:"#4e9a06",43:"#c4a000",44:"#3465a4",45:"#75507b",46:"#06989a",47:"#d3d7cf",100:"#555753",101:"#ef2929",102:"#8ae234",103:"#fce94f",104:"#729fcf",105:"#ad7fa8",106:"#34e2e2",107:"#eeeeee"},this.styles={1:"bold",3:"italic",4:"underline"},this._enableAnsiColor=!0;var t=this;this.onwrite=null,this.element=document.createElement("div"),this.element.setAttribute("class","webterm"),this.content=document.createElement("pre"),this.content.setAttribute("class","content"),this.element.appendChild(this.content),this.writer=document.createElement("pre"),this._writer=document.createElement("input"),this.element.appendChild(this.writer),this.element.appendChild(this._writer),this._cursorColor="#eeeeee",this._history=[],this._currentLine=0,this.element.onkeydown=function(e){t._updateWriter(t._writer.value)},this.element.onkeyup=function(e){t._updateWriter(t._writer.value)},this._writer.onkeydown=function(e){13==e.keyCode?("function"==typeof t.onwrite&&(t.onwrite(this.value),0<this.value.length&&t._history.push(this.value),t._currentLine=t._history.length),this.value="",t._updateWriter("")):38==e.keyCode?(e.preventDefault(),0<t._currentLine&&(t._currentLine--,t._writer.value=t._history[t._currentLine])):40==e.keyCode&&(e.preventDefault(),t._currentLine<t._history.length-1)&&(t._currentLine++,t._writer.value=t._history[t._currentLine])},this.element.onclick=function(e){t._writer.focus(),t._writer.selectionStart=t._writer.value.length-1,t._updateWriter(t._writer.value)},this._initDisplay(),e&&e.appendChild(this.element)}_scrollBottom(){this.element.scrollTop=this.element.scrollHeight}_updateWriter(e){for(var t in e+=" ",this.writer.innerHTML="",e){var i=e[t],r=document.createElement("span");r.innerText=i,t==this._writer.selectionStart&&(r.style.backgroundColor=this._cursorColor,r.style.color=this.element.style.backgroundColor),this.writer.appendChild(r)}}_initDisplay(){this._writer.style.height="1",this._writer.style.backgroundColor="transparent",this._writer.style.color="transparent",this._writer.style.border="none",this._writer.style.outline="none",this._writer.style.position="relative",this._writer.style.zIndex="-100",this.element.style.width="100%",this.element.style.height="100%",this.element.style.backgroundColor="#101010",this.element.style.position="absolute",this.element.style.color="#eeeeee",this.element.style.fontFamily='"Roboto Mono", monospace',this.element.style.overflowY="auto",this.element.style.overflowX="hidden",this.element.style.fontSize="1em",this.element.style.wordWrap="break-word",this.content.style.display="inline",this.content.style.margin="0",this.content.style.padding="0",this.content.style.tabSize="1em",this.content.style.position="relative",this.content.style.zIndex="100",this.content.style.whiteSpace="pre-wrap",this.writer.style.display="inline",this.writer.style.margin="0",this.writer.style.padding="0",this.writer.style.tabSize="1em",this.writer.style.position="relative",this.writer.style.zIndex="100",this.writer.style.whiteSpace="pre-wrap"}clear(){this.content.innerHTML=""}enableAnsiColor(e){this._enableAnsiColor=e}setCursorColor(e){this._cursorColor=e}setColor(e){this.element.style.color=e}setBackgroundColor(e){this.element.style.backgroundColor=e}setSize(e,t){this.element.style.width=e,this.element.style.height=t}setFontFamily(e){this.element.style.fontFamily=e}setFontSize(e){this.writer.style.tabSize=e,this.content.style.tabSize=e,this.element.style.fontSize=e}clearHistory(){this._history=[],this._currentLine=0}write(e){if(this._enableAnsiColor){var t;for(t of this._parseAnsi(e)){var i=document.createElement("span");i.innerText=t.text,t.foreground&&(i.style.color=t.foreground),t.background&&(i.style.backgroundColor=t.background),t.italic&&(i.style.fontStyle="italic"),t.underline&&(i.style.textDecoration="underline"),t.bold&&(i.style.fontWeight="bold"),this.content.append(i)}}else{var r=document.createElement("span");r.innerText=e,this.content.append(r)}this._scrollBottom()}writeln(e){this.write(e),this.content.append(document.createElement("br"))}_parseAnsi(e){var t=this;let i=null,r=null,n="",s=[],l=[],o={};for(var h,a,c=0;c<e.length;c++)null!=i?""==i&&"["==e[c]?(n&&(o.text=n,l.push(o),o={},n=""),i=null,r=""):(n+=i+e[c],i=null):null!=r?";"==e[c]?(s.push(r),r=""):"m"==e[c]?(s.push(r),r=null,n="",s.forEach(function(e){t.foregroundColors[e]?o.foreground=t.foregroundColors[e]:t.backgroundColors[e]?o.background=t.backgroundColors[e]:39==e?delete o.foreground:49==e?delete o.background:t.styles[e]?o[t.styles[e]]=!0:22==e?o.bold=!1:23==e?o.italic=!1:24==e&&(o.underline=!1)}),s=[]):r+=e[c]:""==e[c]?i=e[c]:"\b"==e[c]?(a=h=void 0,n.length?n=n.substr(0,n.length-1):l.length&&(h=l.length-1,1===(a=l[h].text).length?l.pop():l[h].text=a.substr(0,a.length-1))):n+=e[c];return n&&(o.text=n+(i||""),l.push(o)),l}}
